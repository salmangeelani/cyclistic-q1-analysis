---
title: 'Cyclistic Q1 Ride Analysis: Members vs Casual Riders'
author: "Syed Salman Geelani"
date: "`r Sys.Date()`"
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(lubridate)
library(skimr)
library(ggplot2)
```

## üìå Objective

Analyze how **annual members** and **casual riders** used Cyclistic bike-share services during **Q1 (January-March)**, and derive key insights to inform future marketing strategy.

‚ö†Ô∏è Note: This analysis is based only on Q1 2019 and Q1 2020. Seasonal patterns beyond spring are not represented.

------------------------------------------------------------------------

## üì• Data Preparation

```{r load-data}
# Load data files
df_2019 <- read_csv("Divvy_Trips_2019_Q1.csv")
df_2020 <- read_csv("Divvy_Trips_2020_Q1.csv")
```

------------------------------------------------------------------------

## üßº Data Cleaning

```{r clean-data}
#Clean and rename 2019 columns
df_2019_cleaned <- df_2019 %>% 
  mutate(usertype = case_when(
    usertype == "Subscriber" ~ "member",
    usertype == "Customer" ~ "casual",
    TRUE ~ usertype
  )) %>% 
  rename(
    started_at = start_time,
    ended_at = end_time,
    ride_id = trip_id,
    start_station_name = from_station_name,
    start_station_id = from_station_id,
    end_station_id = to_station_id,
    end_station_name = to_station_name
  ) %>%
  mutate(
    start_lat = NA,
    start_lng = NA,
    end_lat = NA,
    end_lng = NA
  ) %>% 
  select(
    ride_id,started_at,ended_at,start_station_name,start_station_id,end_station_name,end_station_id, start_lat, start_lng,
    end_lat, end_lng, usertype
  )

# Clean 2020 data
df_2020_cleaned <- df_2020 %>% 
  rename(
    usertype = member_casual
  ) %>% 
  select(
    ride_id,started_at,ended_at,start_station_name,start_station_id,end_station_name,end_station_id, start_lat, start_lng,
    end_lat, end_lng, usertype
  )
df_2019_cleaned <- df_2019_cleaned %>%
  mutate(ride_id = as.character(ride_id))

df_2020_cleaned <- df_2020_cleaned %>%
  mutate(ride_id = as.character(ride_id))
# Combine both data sets
all_trips <- bind_rows(df_2019_cleaned, df_2020_cleaned)
```

------------------------------------------------------------------------

## üßÆ Feature Engineering

```{r create-columns}
# Calculate columns ride_length and day_of_week
all_trips <- all_trips %>% 
  mutate(
    started_at = ymd_hms(started_at),
    ended_at = ymd_hms(ended_at),
    ride_length = as.numeric(difftime(ended_at,started_at,units = "mins")),
    day_of_week = wday(started_at,label=TRUE, week_start = 1)
  ) 

# Add column season and filter ride_length

all_trips <- all_trips %>% 
  mutate(
    date = as_date(started_at),
    month = month(started_at, label = TRUE),
    year = year(started_at),
    season = case_when(
      month %in% c("Dec","Jan","Feb") ~ "Winter",
      month %in% c("Mar","Apr","May") ~ "Spring",
      month %in% c("Jun","Jul","Aug") ~ "Summer",
      month %in% c("Sep","Oct","Nov") ~ "Autumn"
    )
  ) %>%
  filter(!is.na(ride_length), !is.na(season), !is.na(usertype), ride_length > 1, ride_length < 1440)
  
```

------------------------------------------------------------------------

## üìä  Average Ride Length by Season and User Type

```{r avg-ride-length-plot}

summary_stats <- all_trips %>% 
  group_by(usertype) %>% 
  summarise(
    mean_ride = mean(ride_length),
    median_ride = median(ride_length),
    max_ride = max(ride_length),
    min_ride = min(ride_length)
  )

#Average by day
avg_by_day <- all_trips %>% 
  group_by(usertype, day_of_week) %>% 
  summarise(avg_duration = mean(ride_length), .groups = "drop")

avg_season <- all_trips %>%
  group_by(season, usertype) %>%
  summarise(avg_ride_length = mean(ride_length, na.rm = TRUE), .groups = "drop")

#Visualization

ggplot(avg_season, aes(x=season, y=avg_ride_length, fill = usertype))+
  geom_col(position = "dodge")+
  geom_text(
    aes(label = round(avg_ride_length, 1)),
    position = position_dodge(0.9),
    vjust = -0.5,   # move text slightly above the bar
    size = 5        # increase font size
  )+
  labs(
    title = "Average Ride Length by Season and User Type(Q1 only)",
    x= "Season",
    y= "Average Ride Length(minutes)",
    fill = "User Type"
  )+
  scale_fill_manual(values = c("member" = "#0073C2", "casual" = "#EFC000")) +
  theme_minimal(base_size = 10)

```

------------------------------------------------------------------------

## üìà Insights & Interpretation

-   During Q1, members tend to have slightly longer average ride durations than casual riders.
-   This is likely because commuters (members) ride consistently even in cold months, while casual users may reduce activity.
-   A full-year data set would offer a more balanced seasonal comparison.
-   Q1 may underrepresent casual rider patterns typically seen in warmer months.

------------------------------------------------------------------------

## ‚úÖ Conclusion

-   While this Q1-based analysis reveals active use by members, it also highlights the need for a full-year dataset to see broader behavioral patterns.

-   Marketing can focus on keeping members engaged during low-traffic seasons and encouraging casual riders with winter/spring incentives.

------------------------------------------------------------------------
